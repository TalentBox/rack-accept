<!DOCTYPE html>

<html lang="en">

<head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8">
    <title>Rack::Accept</title>
    <link rel="stylesheet" href="style.css" type="text/css" media="all">
</head>

<body>
    <div id="wrapper">
        <div id="header">
            <h1>rack-accept</h1>
            <ul>
                <li><a href="api/index.html">API</a></li>
                <li><a href="http://github.com/mjijackson/rack-accept/issues">Bugs</a></li>
                <li><a href="http://github.com/mjijackson/rack-accept">Code</a></li>
                <li><a href="usage.html">Usage</a></li>
                <li><a href="index.html">Home</a></li>
            </ul>
        </div>
        <div id="content"><h2>Usage</h2>

<p>Rack::Accept implements the Rack middleware interface and may be used with any
Rack-based application. Simply insert the Rack::Accept module in your Rack
middleware pipeline and access the <a href="api/classes/Rack/Accept/Request.html">Rack::Accept::Request</a> object in the
&ldquo;rack-accept.request&rdquo; environment key, as in the following example:</p>

<pre><code>require 'rack/accept'

use Rack::Accept

app = lambda do |env|
  accept = env['rack-accept.request']
  response = Rack::Response.new

  if accept.media_type?('text/html')
    response['Content-Type'] = 'text/html'
    response.write "&lt;p&gt;Hello. You accept text/html!&lt;/p&gt;"
  else
    response['Content-Type'] = 'text/plain'
    response.write "Apparently you don't accept text/html. Too bad."
  end

  response.finish
end

run app
</code></pre>

<p>Rack::Accept can also construct a <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html#sec10.4.7">406</a> response automatically if you set
up the types of media, character sets, encoding, or languages your server is
able to serve ahead of time.</p>

<pre><code>require 'rack/accept'

use(Rack::Accept) do |accept|
  # We only ever serve content in English or Japanese from this site, so if
  # the user doesn't accept either of these we will respond with a 406.
  #
  # Note: +accept+ is an instance of Rack::Accept::Context.
  accept.languages = %w&lt; en jp &gt;
end

app = ...

run app
</code></pre>

<p><strong>Note:</strong> You should probably think about this very carefully before you use
Rack::Accept in this way. Many user agents are careless about the types of
Accept headers they send, and depend on apps not being too picky. Instead of
automatically sending a 406, you should probably only send one when absolutely
necessary.</p>

<p>Additionally, Rack::Accept may be used outside of a Rack context to provide
any Ruby app the ability to construct and interpret Accept headers.</p>

<pre><code>require 'rack/accept'

mtype = Rack::Accept::MediaType.new
mtype.qvalues = { 'text/html' =&gt; 1, 'text/*' =&gt; 0.8, '*/*' =&gt; 0.5 }
mtype.to_s # =&gt; "Accept: text/html, text/*;q=0.8, */*;q=0.5"

cset = Rack::Accept::Charset.new('unicode-1-1, iso-8859-5;q=0.8')
cset.best_of(%w&lt; iso-8859-5 unicode-1-1 &gt;)  # =&gt; "unicode-1-1"
cset.accept?('iso-8859-1')                  # =&gt; true
</code></pre>

<p>The very last line in this example may look like a mistake to someone not
familiar with the intricacies of <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.3">the spec</a>, but it&rsquo;s actually
correct. It just puts emphasis on the convenience of using this library so you
don&rsquo;t have to worry about these kinds of details.</p>
</div>
        <div id="footer">
            <p><a href="license.html" rel="license">Copyright</a> &copy; 2010 <a href="http://mjijackson.com/about" rel="me author">Michael J. I. Jackson</a></p>
        </div>
    </div>
</body>

</html>
